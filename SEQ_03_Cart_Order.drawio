<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net">
  <diagram name="Cart and Order Sequence Diagrams" id="cart-order-seq">
    <mxGraphModel dx="1434" dy="844" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="2400" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="&lt;h1&gt;Cart &amp;amp; Order Processing Sequence Diagrams&lt;/h1&gt;&lt;p&gt;AppleStore Backend - Giá» hÃ ng vÃ  Äáº·t hÃ ng vá»›i Observer Pattern&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=#d5e8d4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="1520" height="80" as="geometry" />
        </mxCell>
        
        <!-- ==================== ADD TO CART ==================== -->
        <mxCell id="cart-title" value="&lt;h2&gt;1. Add to Cart (ThÃªm sáº£n pháº©m vÃ o giá» hÃ ng)&lt;/h2&gt;" style="text;html=1;strokeColor=none;fillColor=#d5e8d4;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="160" width="1520" height="40" as="geometry" />
        </mxCell>
        
        <!-- Lifelines for Add to Cart -->
        <mxCell id="cart-customer" value="Customer Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="240" width="120" height="480" as="geometry" />
        </mxCell>
        
        <mxCell id="cart-ctrl" value="CartController" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="290" y="240" width="130" height="480" as="geometry" />
        </mxCell>
        
        <mxCell id="cart-svc" value="CartService" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="510" y="240" width="120" height="480" as="geometry" />
        </mxCell>
        
        <mxCell id="cart-prod-repo" value="ProductRepository" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="720" y="240" width="140" height="480" as="geometry" />
        </mxCell>
        
        <mxCell id="cart-item-repo" value="CartItemRepository" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="950" y="240" width="140" height="480" as="geometry" />
        </mxCell>
        
        <mxCell id="cart-db" value="MySQL Database" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="1180" y="240" width="140" height="480" as="geometry" />
        </mxCell>
        
        <!-- Add to Cart Messages -->
        <mxCell id="cart-msg1" value="POST /api/cart&#xa;{productId, quantity}" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="cart-customer" target="cart-ctrl">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="240" y="320" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg2" value="addToCart(cartItemDTO)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="cart-ctrl" target="cart-svc">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="460" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg3" value="Get current user from SecurityContext" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="570" y="380" as="sourcePoint" />
            <mxPoint x="570" y="410" as="targetPoint" />
            <Array as="points">
              <mxPoint x="530" y="380" />
              <mxPoint x="530" y="410" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg4" value="findById(productId)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="cart-svc" target="cart-prod-repo">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="690" y="440" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg5" value="Product entity" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=open;endFill=0;dashed=1;rounded=0;" edge="1" parent="1" source="cart-prod-repo" target="cart-svc">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="690" y="470" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg6" value="Check stock availability" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="570" y="500" as="sourcePoint" />
            <mxPoint x="570" y="530" as="targetPoint" />
            <Array as="points">
              <mxPoint x="530" y="500" />
              <mxPoint x="530" y="530" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg7" value="findByUserIdAndProductId(userId, productId)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="cart-svc" target="cart-item-repo">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="800" y="560" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg8" value="null (not exists)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=open;endFill=0;dashed=1;rounded=0;" edge="1" parent="1" source="cart-item-repo" target="cart-svc">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="800" y="590" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg9" value="Create new CartItem" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="570" y="620" as="sourcePoint" />
            <mxPoint x="570" y="650" as="targetPoint" />
            <Array as="points">
              <mxPoint x="530" y="620" />
              <mxPoint x="530" y="650" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg10" value="save(cartItem)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="cart-svc" target="cart-item-repo">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="800" y="680" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg11" value="INSERT INTO cart_items..." style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="cart-item-repo" target="cart-db">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1130" y="710" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg12" value="CartItemDTO" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=open;endFill=0;dashed=1;rounded=0;" edge="1" parent="1" source="cart-item-repo" target="cart-ctrl">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="620" y="740" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="cart-msg13" value="201 Created&#xa;CartItemDTO" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=open;endFill=0;dashed=1;rounded=0;" edge="1" parent="1" source="cart-ctrl" target="cart-customer">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="240" y="770" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- ==================== CREATE ORDER WITH OBSERVER PATTERN ==================== -->
        <mxCell id="order-title" value="&lt;h2&gt;2. Create Order with Observer Pattern (Táº¡o Ä‘Æ¡n hÃ ng vá»›i thÃ´ng bÃ¡o sá»± kiá»‡n)&lt;/h2&gt;" style="text;html=1;strokeColor=none;fillColor=#e1d5e7;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="820" width="1520" height="40" as="geometry" />
        </mxCell>
        
        <!-- Lifelines for Create Order -->
        <mxCell id="order-customer" value="Customer Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="50" y="900" width="120" height="700" as="geometry" />
        </mxCell>
        
        <mxCell id="order-ctrl" value="OrderController" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="230" y="900" width="130" height="700" as="geometry" />
        </mxCell>
        
        <mxCell id="order-svc" value="OrderService" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="420" y="900" width="120" height="700" as="geometry" />
        </mxCell>
        
        <mxCell id="order-cart-repo" value="CartItemRepository" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="600" y="900" width="140" height="700" as="geometry" />
        </mxCell>
        
        <mxCell id="order-repo" value="OrderRepository" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="800" y="900" width="120" height="700" as="geometry" />
        </mxCell>
        
        <mxCell id="order-event-pub" value="EventPublisher&#xa;(Observer Pattern)" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="980" y="900" width="150" height="700" as="geometry" />
        </mxCell>
        
        <mxCell id="order-observer1" value="EmailObserver" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="1190" y="900" width="130" height="700" as="geometry" />
        </mxCell>
        
        <mxCell id="order-observer2" value="NotificationObserver" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="1380" y="900" width="150" height="700" as="geometry" />
        </mxCell>
        
        <!-- Create Order Messages -->
        <mxCell id="order-msg1" value="POST /api/orders&#xa;{shippingAddress, paymentMethod, ...}" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="order-customer" target="order-ctrl">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="190" y="990" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg2" value="createOrder(orderDTO)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="order-ctrl" target="order-svc">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="380" y="1020" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg3" value="Get current user from SecurityContext" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="480" y="1050" as="sourcePoint" />
            <mxPoint x="480" y="1080" as="targetPoint" />
            <Array as="points">
              <mxPoint x="440" y="1050" />
              <mxPoint x="440" y="1080" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg4" value="findByUserId(userId)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="order-svc" target="order-cart-repo">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="570" y="1110" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg5" value="List&lt;CartItem&gt;" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=open;endFill=0;dashed=1;rounded=0;" edge="1" parent="1" source="order-cart-repo" target="order-svc">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="570" y="1140" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg6" value="Generate order number&#xa;Calculate total amount&#xa;Create Order entity" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="480" y="1170" as="sourcePoint" />
            <mxPoint x="480" y="1220" as="targetPoint" />
            <Array as="points">
              <mxPoint x="430" y="1170" />
              <mxPoint x="430" y="1220" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg7" value="save(order)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="order-svc" target="order-repo">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="740" y="1250" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg8" value="Order entity (saved)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=open;endFill=0;dashed=1;rounded=0;" edge="1" parent="1" source="order-repo" target="order-svc">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="740" y="1280" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg9" value="deleteAll(cartItems)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="order-svc" target="order-cart-repo">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="570" y="1310" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg10" value="publishEvent(OrderCreatedEvent)&#xa;ðŸ”” Observer Pattern" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;strokeColor=#9673a6;strokeWidth=2;" edge="1" parent="1" source="order-svc" target="order-event-pub">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="800" y="1350" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg11" value="notify(event)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;strokeColor=#9673a6;strokeWidth=2;" edge="1" parent="1" source="order-event-pub" target="order-observer1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1160" y="1390" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg12" value="Send email confirmation&#xa;to customer" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1255" y="1420" as="sourcePoint" />
            <mxPoint x="1255" y="1460" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1210" y="1420" />
              <mxPoint x="1210" y="1460" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg13" value="notify(event)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;strokeColor=#9673a6;strokeWidth=2;" edge="1" parent="1" source="order-event-pub" target="order-observer2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1280" y="1490" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg14" value="Create notification&#xa;for customer" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1455" y="1520" as="sourcePoint" />
            <mxPoint x="1455" y="1560" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1400" y="1520" />
              <mxPoint x="1400" y="1560" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg15" value="OrderDTO" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=open;endFill=0;dashed=1;rounded=0;" edge="1" parent="1" source="order-svc" target="order-ctrl">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="380" y="1590" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="order-msg16" value="201 Created&#xa;OrderDTO" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=open;endFill=0;dashed=1;rounded=0;" edge="1" parent="1" source="order-ctrl" target="order-customer">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="190" y="1620" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Observer Pattern Note -->
        <mxCell id="observer-note" value="&lt;b&gt;ðŸ”” Observer Pattern Benefits:&lt;/b&gt;&lt;br&gt;1. Loose coupling - OrderService khÃ´ng phá»¥ thuá»™c vÃ o Observers&lt;br&gt;2. Extensibility - Dá»… dÃ ng thÃªm observers má»›i (SMS, Push notification)&lt;br&gt;3. Async processing - Events Ä‘Æ°á»£c xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™&lt;br&gt;4. Single Responsibility - Má»—i observer xá»­ lÃ½ 1 nhiá»‡m vá»¥ cá»¥ thá»ƒ" style="text;html=1;strokeColor=#9673a6;fillColor=#e1d5e7;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=0" vertex="1" parent="1">
          <mxGeometry x="1000" y="1650" width="480" height="90" as="geometry" />
        </mxCell>
        
        <!-- ==================== UPDATE ORDER STATUS (ADMIN) ==================== -->
        <mxCell id="update-order-title" value="&lt;h2&gt;3. Update Order Status - Admin (Cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng)&lt;/h2&gt;" style="text;html=1;strokeColor=none;fillColor=#e1d5e7;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="1800" width="1520" height="40" as="geometry" />
        </mxCell>
        
        <!-- Lifelines for Update Order Status -->
        <mxCell id="upd-admin" value="Admin Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="100" y="1880" width="120" height="500" as="geometry" />
        </mxCell>
        
        <mxCell id="upd-ctrl" value="OrderController" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="300" y="1880" width="130" height="500" as="geometry" />
        </mxCell>
        
        <mxCell id="upd-svc" value="OrderService" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="510" y="1880" width="120" height="500" as="geometry" />
        </mxCell>
        
        <mxCell id="upd-repo" value="OrderRepository" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="710" y="1880" width="120" height="500" as="geometry" />
        </mxCell>
        
        <mxCell id="upd-event" value="EventPublisher" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="910" y="1880" width="130" height="500" as="geometry" />
        </mxCell>
        
        <mxCell id="upd-obs" value="Observers" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;html=1;container=1;collapsible=0;recursiveResize=0;outlineConnect=0;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="1120" y="1880" width="120" height="500" as="geometry" />
        </mxCell>
        
        <!-- Update Order Status Messages -->
        <mxCell id="upd-msg1" value="PUT /api/orders/{id}/status&#xa;?status=SHIPPED" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="upd-admin" target="upd-ctrl">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="250" y="1970" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="upd-msg2" value="updateOrderStatus(id, SHIPPED)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="upd-ctrl" target="upd-svc">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="460" y="2000" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="upd-msg3" value="findById(id)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="upd-svc" target="upd-repo">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="660" y="2030" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="upd-msg4" value="Order entity" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=open;endFill=0;dashed=1;rounded=0;" edge="1" parent="1" source="upd-repo" target="upd-svc">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="660" y="2060" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="upd-msg5" value="order.setStatus(SHIPPED)&#xa;order.setUpdatedAt(now)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="570" y="2090" as="sourcePoint" />
            <mxPoint x="570" y="2130" as="targetPoint" />
            <Array as="points">
              <mxPoint x="530" y="2090" />
              <mxPoint x="530" y="2130" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="upd-msg6" value="save(order)" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;" edge="1" parent="1" source="upd-svc" target="upd-repo">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="660" y="2160" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="upd-msg7" value="publishEvent(OrderStatusChangedEvent)&#xa;ðŸ”” Observer Pattern" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;strokeColor=#9673a6;strokeWidth=2;" edge="1" parent="1" source="upd-svc" target="upd-event">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="810" y="2200" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="upd-msg8" value="notifyAll(event)&#xa;Send updates to customer" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=block;rounded=0;strokeColor=#9673a6;strokeWidth=2;" edge="1" parent="1" source="upd-event" target="upd-obs">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1070" y="2240" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="upd-msg9" value="OrderDTO" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=open;endFill=0;dashed=1;rounded=0;" edge="1" parent="1" source="upd-svc" target="upd-ctrl">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="460" y="2280" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="upd-msg10" value="200 OK&#xa;OrderDTO" style="edgeStyle=orthogonalEdgeStyle;html=1;align=left;spacingLeft=2;endArrow=open;endFill=0;dashed=1;rounded=0;" edge="1" parent="1" source="upd-ctrl" target="upd-admin">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="250" y="2320" />
            </Array>
          </mxGeometry>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
